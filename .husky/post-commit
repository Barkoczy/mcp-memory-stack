#!/usr/bin/env sh

echo "ğŸ“ Post-commit actions..."

# Get commit info
commit_hash=$(git rev-parse HEAD)
commit_message=$(git log -1 --pretty=%B)
files_changed=$(git diff-tree --no-commit-id --name-only -r HEAD | wc -l)

echo "âœ… Commit successful!"
echo "ğŸ“Š Hash: $commit_hash"
echo "ğŸ“ Files changed: $files_changed"

# Check if this is a major change (many files)
if [ "$files_changed" -gt 10 ]; then
  echo "ğŸ” Large commit detected ($files_changed files)"
  echo "ğŸ’¡ Consider running integration tests: npm run test:integration"
fi

# Suggest actions based on commit type
case "$commit_message" in
  feat*)
    echo "ğŸ‰ New feature added!"
    echo "ğŸ’¡ Don't forget to:"
    echo "   - Update documentation if needed"
    echo "   - Add tests for the new feature"
    echo "   - Update CHANGELOG.md"
    ;;
  fix*)
    echo "ğŸ”§ Bug fix committed!"
    echo "ğŸ’¡ Consider:"
    echo "   - Adding regression tests"
    echo "   - Checking if documentation needs updates"
    ;;
  docs*)
    echo "ğŸ“š Documentation updated!"
    ;;
  test*)
    echo "ğŸ§ª Tests updated!"
    echo "ğŸ’¡ Run the test suite: npm test"
    ;;
  refactor*)
    echo "â™»ï¸  Code refactored!"
    echo "ğŸ’¡ Consider running full test suite: npm test"
    ;;
  perf*)
    echo "âš¡ Performance improvement!"
    echo "ğŸ’¡ Consider running performance benchmarks"
    ;;
  ci*|build*)
    echo "ğŸ”§ CI/Build configuration updated!"
    echo "ğŸ’¡ Monitor next CI/CD pipeline run"
    ;;
esac

# Check if package.json was modified
if git diff-tree --no-commit-id --name-only -r HEAD | grep -q "package.json"; then
  echo "ğŸ“¦ package.json was modified"
  echo "ğŸ’¡ Run 'npm install' to update dependencies"
  echo "ğŸ’¡ Consider updating package-lock.json if needed"
fi

# Check if Docker files were modified
if git diff-tree --no-commit-id --name-only -r HEAD | grep -qE "(Dockerfile|docker-compose.*\.yml)"; then
  echo "ğŸ³ Docker configuration was modified"
  echo "ğŸ’¡ Consider rebuilding Docker images: npm run docker:build"
fi

echo ""